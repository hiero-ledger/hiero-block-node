$schema: "https://json-schema.org/draft/2020-12/schema"
$title: "Network Topology Schema"
$type: object
$defs:
    nodeRef:
        type: string
        description: "Reference to a node by its identifier"
    nodeLink:
        type: object
        description: "Reference to a node with an optional connection priority override"
        required: ["node"]
        properties:
            node:
                $ref: "#/$defs/nodeRef"
            priority:
                type: integer
                minimum: 1
        additionalProperties: false
    nodePriorityEntry:
        type: object
        description: "Single-key map associating a node with a priority"
        minProperties: 1
        maxProperties: 1
        propertyNames:
            pattern: "^[a-zA-Z0-9_-]+$"
        additionalProperties:
            type: integer
            minimum: 1
    address:
        type: string
        description: "Resolvable hostname or IP address of the node"
        examples: ["localhost", "bn1.example.com"]
    port:
        type: integer
        description: "TCP port the node listens on"
        minimum: 1
        maximum: 65535

properties:
    block_nodes:
        type: object
        description: "All Block Nodes (BN) available in the network"
        patternProperties:
            "^[a-zA-Z0-9_-]+$":
                type: object
                required: ["address", "port"]
                properties:
                    address:
                        $ref: "#/$defs/address"
                    port:
                        $ref: "#/$defs/port"
                    priority:
                        type: integer
                        description: "Optional connection priority"
                        minimum: 1
                    peers:
                        type: array
                        description: "List of other block-nodes this BN connects to"
                        items:
                            anyOf:
                                - $ref: "#/$defs/nodeRef"
                                - $ref: "#/$defs/nodeLink"
                                - $ref: "#/$defs/nodePriorityEntry"
                        uniqueItems: true
                additionalProperties: false
        additionalProperties: false

    consensus_nodes:
        type: object
        description: "Consensus Nodes (CN) that connect to one or more Block Nodes"
        patternProperties:
            "^[a-zA-Z0-9_-]+$":
                type: object
                required: ["block_nodes"]
                properties:
                    block_nodes:
                        type: array
                        description: "List of block-node identifiers this CN connects to"
                        items:
                            anyOf:
                                - $ref: "#/$defs/nodeRef"
                                - $ref: "#/$defs/nodeLink"
                                - $ref: "#/$defs/nodePriorityEntry"
                        minItems: 1
                        uniqueItems: true
                additionalProperties: false
        additionalProperties: false

required: ["block_nodes", "consensus_nodes"]
additionalProperties: false
