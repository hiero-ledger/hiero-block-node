# SPDX-License-Identifier: Apache-2.0
#
# Smoke Test
#
# Quick validation that the network is functioning correctly.
# Verifies all block nodes are healthy and receiving blocks.
#
# Prerequisites:
#   - Any topology deployed (default: single)
#   - Port forwards active (task port-forward)
#
# Usage:
#   task test:run TEST_FILE=tests/smoke-test.yaml

name: smoke-test
description: "Quick smoke test for network validation"

events:
  - id: initial-status
    type: network-status
    description: "Initial network status"
    delay: 5

  - id: early-metrics
    type: print-metrics
    description: "Early metrics snapshot"
    delay: 30
    args:
      target: all

  - id: mid-metrics
    type: print-metrics
    description: "Mid-test metrics"
    delay: 60
    args:
      target: all

  - id: final-status
    type: network-status
    description: "Final network status"
    delay: 90

assertions:
  - id: all-healthy
    type: node-healthy
    description: "All Block Nodes are healthy"
    target: all

  - id: all-have-blocks
    type: block-available
    description: "All Block Nodes have blocks"
    target: all
    args:
      min_block: 0

  - id: all-blocks-increasing
    type: blocks-increasing
    description: "All Block Nodes are receiving new blocks"
    target: all
    args:
      wait_seconds: 30
